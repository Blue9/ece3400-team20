<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>ECE 3400 Team 20 - Final Design Report</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- Plugin CSS -->
    <link href="vendor/magnific-popup/magnific-popup.css" rel="stylesheet" type="text/css">

    <!-- Custom styles for this template -->
    <link href="css/freelancer.css" rel="stylesheet">
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg bg-secondary fixed-top text-uppercase" id="mainNav">
      <div class="container">
          <a class="navbar-brand js-scroll-trigger" href="#page-top">ECE 3400</a>
          <button class="navbar-toggler navbar-toggler-right text-uppercase bg-primary text-white rounded" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          Menu
          <i class="fa fa-bars"></i>
          </button>
          <div class="collapse navbar-collapse" id="navbarResponsive">
              <ul class="navbar-nav ml-auto">
                  <li class="nav-item mx-0 mx-lg-1">
                      <a class="nav-link py-3 px-0 px-lg-3 rounded" href="index.html">Labs</a>
                  </li>
                  <li class="nav-item mx-0 mx-lg-1">
                      <a class="nav-link py-3 px-0 px-lg-3 rounded" href="teamcontract.html">Contract</a>
                  </li>
                  <li class="nav-item mx-0 mx-lg-1">
                    <a class="nav-link py-3 px-0 px-lg-3 rounded" href="ethics.html">Ethics HW</a>
                  </li>
                  <li class="nav-item mx-0 mx-lg-1">
                    <a class="nav-link py-3 px-0 px-lg-3 rounded active" href="final.html">Design Report</a>
                  </li>
                  <li class="nav-item mx-0 mx-lg-1">
                    <a class="nav-link py-3 px-0 px-lg-3 rounded" href="https://github.com/Blue9/ece3400-team20">GitHub <i class="fa fa-external-link"></i></a>
                  </li>
              </ul>
          </div>
      </div>
    </nav>
    
    <!-- Header -->
    <header class="masthead bg-primary text-white text-center">
        <div class="container">
                <div class="w-100 text-center mb-4">
                        <div class="shiny" style="display: inline-block; width:256px; height: 256px; border-radius: 128px;">
                            <img class="img-fluid mb-5 d-block mx-auto" src="img/robot.png" alt="" style="width: 256px; height: 256px;">
                        </div>
                    </div>
                <h1 class="text-uppercase mb-0">Design Report</h1>
                <hr class="star-light">
                </div>
    </header>
    
    <div class="container" style="margin-top:40px; max-width: 960px;">
      <div class="row">
        <div class="col-12">
                <h2><a id="Final_Robot_Design_Lab_Review_0"></a>Final Robot Design Lab Review</h2>
                <p>Our final robot was a culmination of all of the previous labs and milestones on this site. The purpose of building this robot was to compete in a maze mapping competition in which we earn points for following white lines in the maze, detecting and avoiding walls in it, performing image processing in order to identify objects around it (i.e treasures), and then transmitting information about what the maze looks like to a base-station located several feet away. We summarize how our previous work led to our final robot system as follows:</p>
                <p><em>Lab 1:</em></p>
                <p>We learned how to work with Arduinos, manipulating the orientation of the Servos, and work with the basic parts of building the robot. Our final robot ran on an Arduino Uno and moved using two Parallax Orientation Rotation Servos found<br>
                here: <a href="http://www.parallax.com/downloads/continuous-rotation-servo-documentation">http://www.parallax.com/downloads/continuous-rotation-servo-documentation</a></p>
                <p><em>Milestone 1:</em>:</p>
                <p>Our final robot utilized two line following sensors located at the front of the robot. Using the readings from these sensors, we developed line following algorithms that implied the nature of the orientation of the robot. For example, if the left line sensor is indicating that it is on white and the right line sensor is indicating that it is on black, then our robot must be turning too far to the right and must adjust accordingly via the servos.</p>
                <p><em>Lab 2:</em> We learned the basics of FFT analysis and how to determine the frequency of an incoming signal. We developed an audio circuit as follows and had audio FFT analysis for 660 Hz within the code. Our circuit on the robot is as follows:</p>
               
                <div class="text-center w-100">
                    <img src="https://github.com/Blue9/ece3400-team20/blob/gh-pages/img/portfolio/MicrophoneCircuit.png?raw=true" width=700px;>
                </div>
                <p>Similarly we added an IR Hat near the top and an IR sensor on the front in order to perform FFT analysis to detect other robots at 6080 Hz for obstacle avoidance.</p>
                <p><em>Lab 3:</em> Our robot had an nRF24L01 transceiver on it in order to transmit information about its orientation and what is going on around it, i.e. walls, other robots, and if there are treasures located around it. We developed our own data scheme in order to transmit this information once we obtained it and then updated a GUI at a base station that showed what the maze looked like based on the transmission.</p>
                <p><em>Milestone 2:</em> We had three short distance wall sensors in the front, right, and left sides of our robot, creating state transitions in our finite state machine code based on their values.</p>
                <p><em>Lab 4 / Milestone 4:</em> We learned the basics of image processing for shapes and color by working with the OV7670 camera and an FPGA. We decided that the tradeoff between lost points for false detection was too much and decided not to place it on the robot. We made this decision utilizing the frameworks provided by the conflict resolution guest lectures.</p>
                <p><em>Milestone 3:</em> Taking into account sensor values for close obstacles, our robot performed a DFS traversal within the maze at the final competition.</p>
                <p>With all the sensors on the robot (wall, line, IR, Audio) and the radios, we found ourselves running out of pins. And so our final robot also contained a multiplexer. In addition, we added a push button in the event that our audio FFT was no longer working that could start the maze traversal when pressed.</p>
                <p>We found creating a finite state machine to be immensely useful for both debugging and performance. A diagram is also as follows:</p>
                <p><em>Robot Budget:</em><br>
                2 line sensors - $6<br>
                3 IR distance sensors - $21<br>
                2 parallax servos - $26<br>
                1 Arduino Uno - $16<br>
                Total: $69</p>
                <h3><a id="Challenges_Encountered_Through_The_Semester_38"></a>Challenges Encountered Through The Semester</h3>
                <p>Our main challenges revolved around the reliability of the hardware components. At the beginning of this class, we spent several hours perfecting our line following method from Lab 1.  We initially incorporated delays into our turning methods, but then realized that this was not robust enough and what we really needed to have was a finite state machine, so that at every moment the robot would make an appropriate decision. The combination of this and short time delays approximately equal to the propagation delay helped perfect our line following. We were also able to implement and account for situations where the robot moves off track and needs to return back to a white line.</p>
                <p>Another main source of errors came from the audio FFT circuit which required close proximity to the sound source.  We fixed this by increasing the gain of the Op Amp and filtering with a cutoff frequency close to the desired frequency.</p>
                <p>The short distance sensors posed problems during the DFS maze traversal. With different light settings we had problems calibrating the sensors and finding their threshold. It was critical to get the wall/no-wall threshold close enough to the exact value as our maze traversal algorithm depended on it. We initially thought to self-calibrate before the robot first starts, by examining the surroundings and then mapping its thresholds accordingly, but this proved too difficult to do.  We instead had to hardcode the values at each start. In hindsight, it would have been easiest to just purchase digital short distance sensors.</p>
                <p>We had a few problems with transmitting information from sender to receiver.  More specifically, when we first started working on it, there were times where packets were dropped.  To fix this, we thought of implementing a TCP type scheme where we have an acknowledgement check and transmit again if it the check is missing, but this proved to be difficult to implement.  Instead, we found that when we swapped out our radio, communication improved drastically. This fixed our problem.</p>
                <p>We had a lot of problems with keeping the dynamic memory under the memory cap.  After integrating DFS with the existing code, we found that we were over dynamic memory usage.  To fix this, we examined the memory usage of each component and saw that the audio FFT part used the most memory. The night before the final competition day, we were unable to get the FFT working, so we made a critical design decision to forego points on the tone starting so that we had a comfortable amount of dynamic memory to work with.  We decided that having enough space to ensure the robustness of the maze traversal algorithm was more important than starting on the tone.</p>
                <p>The chassis of the robot was an iteration of a series of chasses we made. In our first chassis, we did not have good parts and the Arduino sat close to the ground. This is good in terms of center of mass and stability, but caused a lot of problems in raw noise when line following.  We redid the chassis to have the Arduino off the ground and mounted line sensors below the Arduino. This fixed our yaw problem but made the robot sometimes flip over due to not enough weight in the front of the robot.  In our final design, we kept this but accounted for this by putting the IR battery in the front. This helped the stability as well as allowed us to save space.</p>
                <p>With regards to the FPGA image processing and camera interaction, we found it incredibly challenging to obtain a stable image on the screen even though our downsampler passed the color bar test. Since we ran out of ribbon wires, we had to crimp our own and consistently found poor image quality. Replacing the wires with ribbon wires we found, the image became much better but still unstable with regards to color and quality as a result of issues with VSYNC transmission. We attempted to make sure that the VSYNC we receive was stable by keeping track of previous VSYNC values but still had issues.</p>
                <p>The breadboard we used often caused wires to come loose.  A few days before the final competition, we decided to port the schematic to a solder board and solder wires to ensure that they don’t fall off. This was a huge time investment which unfortunately resulted in an impossible to find short in our circuit.  We spent a while trying to find out where the short was coming from, but eventually found that it was not a short and rather a bigger problem which we did not have the time to solve. The day before the competition we redid the circuitry putting it back onto a breadboard.  If we had more time we would have tried the solder board again or a printed circuit board</p>
                <h3><a id="Them_vs_The_Robot_They_Tell_You_Not_To_Worry_About_56"></a>Them vs. the robot they tell you not to worry about</h3>
                <p>Line following:</p>
                <ul>
                <li>Them:  Delays, hardcoded turns, unreliable line following, falling off track</li>
                <li>Us:  A robust finite state machine with perfect line following even off track</li>
                </ul>
                <p>Chassis:</p>
                <ul>
                <li>Them:  Unstable piece of plastic</li>
                <li>Us:  Carefully laser cut wood to dampen noise and reduce mechanical perturbations.</li>
                </ul>
                <p>Audio FFT:</p>
                <ul>
                <li>Them:  Basic Op Amp which amplifies signals rather than filter a desired signal</li>
                <li>Us:  A lowpass filter with cutoff frequency within 10% of desired frequency with boost.</li>
                </ul>
                <p>Short Distance Sensors:</p>
                <ul>
                <li>Them:  One, unreliable read.</li>
                <li>Us:  High speed redundancy to ensure correctness.</li>
                </ul>
                <p>Algorithm:</p>
                <ul>
                <li>Them:  Textbook DFS</li>
                <li>Us:  DFS with secret optimizations.</li>
                </ul>
                <h3><a id="Final_Competition_Video_78"></a>Final Competition Video</h3>
                <p><a href="https://www.youtube.com/watch?v=KY3ScgbzLN8">https://www.youtube.com/watch?v=KY3ScgbzLN8</a></p>
                <p>(Not embedded due to copyright restrictions)</p>
        </div>
      </div>
      </div>
    </div>
  </body>
</html>
